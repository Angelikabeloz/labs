<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />




<title>Modelling</title>

<script src="6-modelling_files/header-attrs-2.11/header-attrs.js"></script>
<script src="6-modelling_files/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="6-modelling_files/bootstrap-3.3.5/css/lumen.min.css" rel="stylesheet" />
<script src="6-modelling_files/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="6-modelling_files/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="6-modelling_files/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="6-modelling_files/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="6-modelling_files/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="6-modelling_files/tocify-1.9.1/jquery.tocify.js"></script>
<script src="6-modelling_files/navigation-1.1/tabsets.js"></script>
<link href="6-modelling_files/pagedtable-1.1/css/pagedtable.css" rel="stylesheet" />
<script src="6-modelling_files/pagedtable-1.1/js/pagedtable.js"></script>

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>


<style type="text/css">
  code {
    white-space: pre;
  }
  .sourceCode {
    overflow: visible;
  }
</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  background-color: #f8f8f8; }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ef2929; } /* Alert */
code span.an { color: #8f5902; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #c4a000; } /* Attribute */
code span.bn { color: #0000cf; } /* BaseN */
code span.cf { color: #204a87; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4e9a06; } /* Char */
code span.cn { color: #000000; } /* Constant */
code span.co { color: #8f5902; font-style: italic; } /* Comment */
code span.cv { color: #8f5902; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #8f5902; font-weight: bold; font-style: italic; } /* Documentation */
code span.dt { color: #204a87; } /* DataType */
code span.dv { color: #0000cf; } /* DecVal */
code span.er { color: #a40000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #0000cf; } /* Float */
code span.fu { color: #000000; } /* Function */
code span.im { } /* Import */
code span.in { color: #8f5902; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #204a87; font-weight: bold; } /* Keyword */
code span.op { color: #ce5c00; font-weight: bold; } /* Operator */
code span.ot { color: #8f5902; } /* Other */
code span.pp { color: #8f5902; font-style: italic; } /* Preprocessor */
code span.sc { color: #000000; } /* SpecialChar */
code span.ss { color: #4e9a06; } /* SpecialString */
code span.st { color: #4e9a06; } /* String */
code span.va { color: #000000; } /* Variable */
code span.vs { color: #4e9a06; } /* VerbatimString */
code span.wa { color: #8f5902; font-weight: bold; font-style: italic; } /* Warning */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    for (var j = 0; j < rules.length; j++) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") continue;
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') continue;
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>




<link rel="stylesheet" href="custom.css" type="text/css" />



<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
pre code {
  padding: 0;
}
</style>



<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "Óâô";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "Óâô";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->



<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}

@media print {
.toc-content {
  /* see https://github.com/w3c/csswg-drafts/issues/4434 */
  float: right;
}
}

.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div id="header">



<h1 class="title toc-ignore">Modelling</h1>
<h3 class="subtitle">Reporting, summarising and communicating models in R</h3>

</div>


<hr />
<p>Welcome back! I hope you all enjoyed the course-free Midterm Week! üèñ</p>
<p>Last week we talked a bit about how you might scrape innovative data from the web. Collecting data is not an end in itself, rather you do it to be able to run models that explore, infer or predict outcomes. We won‚Äôt focus on the statistical considerations that inform your model choice, instead we will show you how to:</p>
<ul>
<li>use formulas to specify multiple models</li>
<li>processing (estimation) model results with <code>broom</code></li>
<li>summarise outputs with <code>modelsummary</code></li>
<li>communicate results through plots and tables</li>
</ul>
<hr />
<div id="the-model-workflow-with-r" class="section level1">
<h1>The Model Workflow with R</h1>
<p>While the last session dealt with one of the sexier areas of Data Science (Web Scraping), today we will go back to the <strong>bread and butter</strong> üçû of any self-respecting data scientist - modelling!</p>
<p>But if we are not even talking about ML, DL or model choice, why bother? Well, as with most things it is worth to revisit fundamentals from time to time. By investing just a little more effort here, we can create <em>much better</em> reports and papers!</p>
<p>In general, remember, your basic <strong>workflow for evaluating and reporting models</strong> is the following:</p>
<p><img src="pics/data-science-communicate.png" width="90%" style="display: block; margin: auto;" /></p>
<p>Today we will mostly deal with the model and communicate steps in the graph.</p>
<hr />
</div>
<div id="setup" class="section level1">
<h1>Setup</h1>
<p>Before we get started with the actual coding we need to load a few packages and get some data. We are using <a href="https://www.kaggle.com/kumarajarshi/life-expectancy-who">this WHO dataset</a> on life expectancy.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>pacman<span class="sc">::</span><span class="fu">p_load</span>(tidyverse, broom, modelsummary, estimatr, janitor, modelr)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>life_expec_dat <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">&quot;life_expectancy.csv&quot;</span>) <span class="sc">%&gt;%</span> <span class="fu">clean_names</span>()</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(life_expec_dat)</span></code></pre></div>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["country"],"name":[1],"type":["chr"],"align":["left"]},{"label":["year"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["status"],"name":[3],"type":["chr"],"align":["left"]},{"label":["life_expectancy"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["adult_mortality"],"name":[5],"type":["dbl"],"align":["right"]},{"label":["infant_deaths"],"name":[6],"type":["dbl"],"align":["right"]},{"label":["alcohol"],"name":[7],"type":["dbl"],"align":["right"]},{"label":["percentage_expenditure"],"name":[8],"type":["dbl"],"align":["right"]},{"label":["hepatitis_b"],"name":[9],"type":["dbl"],"align":["right"]},{"label":["measles"],"name":[10],"type":["dbl"],"align":["right"]},{"label":["bmi"],"name":[11],"type":["dbl"],"align":["right"]},{"label":["under_five_deaths"],"name":[12],"type":["dbl"],"align":["right"]},{"label":["polio"],"name":[13],"type":["dbl"],"align":["right"]},{"label":["total_expenditure"],"name":[14],"type":["dbl"],"align":["right"]},{"label":["diphtheria"],"name":[15],"type":["dbl"],"align":["right"]},{"label":["hiv_aids"],"name":[16],"type":["dbl"],"align":["right"]},{"label":["gdp"],"name":[17],"type":["dbl"],"align":["right"]},{"label":["population"],"name":[18],"type":["dbl"],"align":["right"]},{"label":["thinness_1_19_years"],"name":[19],"type":["dbl"],"align":["right"]},{"label":["thinness_5_9_years"],"name":[20],"type":["dbl"],"align":["right"]},{"label":["income_composition_of_resources"],"name":[21],"type":["dbl"],"align":["right"]},{"label":["schooling"],"name":[22],"type":["dbl"],"align":["right"]}],"data":[{"1":"Afghanistan","2":"2015","3":"Developing","4":"65","5":"263","6":"62","7":"0.01","8":"71.3","9":"65","10":"1154","11":"19","12":"83","13":"6","14":"8.2","15":"65","16":"0.1","17":"584","18":"33736494","19":"17","20":"17","21":"0.48","22":"10.1"},{"1":"Afghanistan","2":"2014","3":"Developing","4":"60","5":"271","6":"64","7":"0.01","8":"73.5","9":"62","10":"492","11":"19","12":"86","13":"58","14":"8.2","15":"62","16":"0.1","17":"613","18":"327582","19":"18","20":"18","21":"0.48","22":"10.0"},{"1":"Afghanistan","2":"2013","3":"Developing","4":"60","5":"268","6":"66","7":"0.01","8":"73.2","9":"64","10":"430","11":"18","12":"89","13":"62","14":"8.1","15":"64","16":"0.1","17":"632","18":"31731688","19":"18","20":"18","21":"0.47","22":"9.9"},{"1":"Afghanistan","2":"2012","3":"Developing","4":"60","5":"272","6":"69","7":"0.01","8":"78.2","9":"67","10":"2787","11":"18","12":"93","13":"67","14":"8.5","15":"67","16":"0.1","17":"670","18":"3696958","19":"18","20":"18","21":"0.46","22":"9.8"},{"1":"Afghanistan","2":"2011","3":"Developing","4":"59","5":"275","6":"71","7":"0.01","8":"7.1","9":"68","10":"3013","11":"17","12":"97","13":"68","14":"7.9","15":"68","16":"0.1","17":"64","18":"2978599","19":"18","20":"18","21":"0.45","22":"9.5"},{"1":"Afghanistan","2":"2010","3":"Developing","4":"59","5":"279","6":"74","7":"0.01","8":"79.7","9":"66","10":"1989","11":"17","12":"102","13":"66","14":"9.2","15":"66","16":"0.1","17":"553","18":"2883167","19":"18","20":"18","21":"0.45","22":"9.2"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<hr />
</div>
<div id="using-formulae-in-r" class="section level1">
<h1>Using Formulae in R</h1>
<p>R as coding language was specifically designed with statistical analysis in mind. Therefore the founding fathers of R üôå - in their infinite wisdom - decided to create a special object class (called <code>formula</code>) to help us run models.</p>
<div id="syntax" class="section level2">
<h2>Syntax</h2>
<p>A quick recap on the syntax that you can use within formulae. The <code>~</code> sign generally differentiates between dependent and independent variables. The <code>+</code> sign is used to distinguish between independent variables. Here are a few other lines that are nice to know:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>y <span class="sc">~</span> x1 <span class="sc">+</span> x2 <span class="co"># standard formula</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>y <span class="sc">~</span> . <span class="co"># include all other columns in data as x vars</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>y <span class="sc">~</span> x1 <span class="sc">*</span> x2 <span class="co"># Interaction terms</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>y <span class="sc">~</span> x <span class="sc">+</span> <span class="fu">I</span>(x<span class="sc">^</span><span class="dv">2</span>) <span class="co"># higher order terms</span></span></code></pre></div>
<p>Formulae are very straightforward to work with. To avoid any errors you should follow the following two steps.</p>
<p><strong>Step 1:</strong> create a string containing the written formula. The <code>paste</code> function from last week is useful for this.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>formula_string <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="st">&quot;life_expectancy&quot;</span>, <span class="st">&quot;~ gdp&quot;</span>)</span></code></pre></div>
<p><strong>Step 2:</strong> transform the string into R class formula. Only then can you plug it into the model function.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>form <span class="ot">&lt;-</span> <span class="fu">as.formula</span>(formula_string) <span class="co"># needs to be transformed to correct class</span></span></code></pre></div>
<p>Here is the proof that both ways of doing it are identical.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>form <span class="ot">&lt;-</span> <span class="fu">lm</span>(form, <span class="at">data =</span> life_expec_dat)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>reg <span class="ot">&lt;-</span> <span class="fu">lm</span>(life_expectancy <span class="sc">~</span> gdp, <span class="at">data =</span> life_expec_dat)</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>form<span class="sc">$</span>coefficients <span class="sc">==</span> reg<span class="sc">$</span>coefficients</span></code></pre></div>
<pre><code>## (Intercept)         gdp 
##        TRUE        TRUE</code></pre>
</div>
<div id="for-iteration" class="section level2">
<h2>For Iteration</h2>
<p>We encourage you to <strong>fit many models</strong>, ranging from simple to complex, and formulae can help you in the iteration process.</p>
<p>Often, the modelling process requires you to run the same specification with <strong>multiple configurations</strong> of both <strong>dependent</strong> and <strong>independent</strong> variables. Model formulae make running many similar models super easy:</p>
<p><strong>Step 1</strong>: You define a function that let‚Äôs you plug in different variables at x or y. These functions take the y or x variable(s) as a string and return a model object.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># iterate over different y variables.</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>lm_fun_iter_y <span class="ot">&lt;-</span>  <span class="cf">function</span>(dep_var) {</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lm</span>( <span class="fu">as.formula</span>(<span class="fu">paste</span>(dep_var, <span class="st">&quot;~ gdp&quot;</span>)), <span class="at">data =</span> life_expec_dat)</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a><span class="co"># iterate over different x variables. </span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>lm_fun_iter_x <span class="ot">&lt;-</span> <span class="cf">function</span>(indep_var) {</span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lm</span>( <span class="fu">as.formula</span>(<span class="fu">paste</span>(<span class="st">&quot;life_expectancy ~&quot;</span>, <span class="fu">paste</span>(indep_var, <span class="at">collapse =</span> <span class="st">&quot;+&quot;</span>))), <span class="at">data =</span> life_expec_dat)</span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p><span style="color: red;">Notice:</span> It is unlikely you will run just a simple bivariate regression (i.e.¬†your model will include many independent variables). Therefore, we need to use a nested paste function that combines (<code>collapse()</code>) the input character vector with <code>+</code>.</p>
<p><strong>Step 2</strong>: You use <code>map()</code> (cf.¬†<a href="https://raw.githack.com/intro-to-data-science-21/labs/main/session-4-databases/4-databases.html">lab-session 4</a> to iterate the model over a vector or list of input variables:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># create vector of variables to iterate over</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>vars <span class="ot">&lt;-</span> life_expec_dat <span class="sc">%&gt;%</span> </span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(<span class="st">&quot;life_expectancy&quot;</span>, <span class="st">&quot;country&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">names</span>()</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a><span class="co"># run a bivariate model for each column</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>biv_model_out <span class="ot">&lt;-</span>  vars <span class="sc">%&gt;%</span></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">map</span>(lm_fun_iter_x)</span></code></pre></div>
<p>This returns a list of all the models that your ran. Given that there are a quite a few models now, so it might be an idea to retain the names of the variables that you feed into your model. You can do this with <code>purrr::set_names()</code>.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># run a bivariate model for each column</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>biv_model_out_w_names <span class="ot">&lt;-</span>  vars <span class="sc">%&gt;%</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_names</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">map</span>(lm_fun_iter_x)</span></code></pre></div>
<p>What if you want to run several different multivariate models? In addition to the code from the lectures you could use <code>modelR::formulas</code>:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># create list of combinations of vars</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>indep_vars_combos <span class="ot">&lt;-</span> modelr<span class="sc">::</span><span class="fu">formulas</span>(<span class="sc">~</span>life_expectancy,</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>                       <span class="at">bivariate =</span> <span class="sc">~</span> gdp,</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>                       <span class="at">multivariate =</span> <span class="sc">~</span> gdp <span class="sc">+</span> population <span class="sc">+</span> total_expenditure,</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>                       <span class="at">interaction =</span> <span class="sc">~</span> gdp <span class="sc">+</span> population <span class="sc">*</span> total_expenditure,</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>                       <span class="at">higher_order =</span> <span class="sc">~</span> gdp <span class="sc">+</span> <span class="fu">I</span>(gdp<span class="sc">^</span><span class="dv">2</span>))</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>multiv_model_out <span class="ot">&lt;-</span> indep_vars_combos <span class="sc">%&gt;%</span>  <span class="fu">map</span>(lm, <span class="at">data =</span> life_expec_dat)</span></code></pre></div>
<p>As you can see the function in the lecture is a lot more powerful, but in my admittedly very modest experience, the preceding code resembles the actual scientific workflow more closely.</p>
<hr />
</div>
</div>
<div id="model-output-with-broom" class="section level1">
<h1>Model Output with <code>broom</code></h1>
<p>By inspecting either of these model lists, you can see how unwieldy they can be. In the lecture Simon pointed out that we are interested in three main aspects of out model outputs:</p>
<ul>
<li><strong>Estimated coefficients</strong> and associated standard errors, T-statistics, p-values, confidence intervals</li>
<li><strong>Model summaries</strong>, including goodness of fit measures, information on model convergence, number of observations used</li>
<li><strong>Observation-level</strong> information that arises from the estimated model, such as fitted/predicted values, residuals, estimates of influence</li>
</ul>
<p>Extracting this information from the vanilla model output is possible, but hardly ideal:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(multiv_model_out[[<span class="dv">3</span>]])</span></code></pre></div>
<pre><code>## List of 13
##  $ coefficients : Named num [1:5] 63.16424473843 0.000312881029 0.000000002532 0.558525960045 -0.000000000508
##   ..- attr(*, &quot;names&quot;)= chr [1:5] &quot;(Intercept)&quot; &quot;gdp&quot; &quot;population&quot; &quot;total_expenditure&quot; ...
##  $ residuals    : Named num [1:2120] -2.85 -8.02 -7.95 -8.63 -8.38 ...
##   ..- attr(*, &quot;names&quot;)= chr [1:2120] &quot;1&quot; &quot;2&quot; &quot;3&quot; &quot;4&quot; ...
##  $ effects      : Named num [1:2120] -3158.94 212.28 3.59 -58.45 -1.47 ...
##   ..- attr(*, &quot;names&quot;)= chr [1:2120] &quot;(Intercept)&quot; &quot;gdp&quot; &quot;population&quot; &quot;total_expenditure&quot; ...
##  $ rank         : int 5
##  $ fitted.values: Named num [1:2120] 67.9 67.9 67.9 68.1 67.6 ...
##   ..- attr(*, &quot;names&quot;)= chr [1:2120] &quot;1&quot; &quot;2&quot; &quot;3&quot; &quot;4&quot; ...
....</code></pre>
<div id="tidying-model-ojects" class="section level2">
<h2>Tidying Model Ojects</h2>
<p>Luckily we don‚Äôt have to deal with this. We use a package called <code>broom</code> that is part of the <a href="https://www.tidyverse.org/">tidyverse</a> and more precisely <a href="https://www.tidymodels.org/">tidymodels</a>. The latter offers a lot of cool packages that have their own tutorials, so check them out! üí™.</p>
<p>We will only focus on broom. As a reminder, here are the three key broom functions that you need to learn:</p>
<ol style="list-style-type: decimal">
<li><code>tidy()</code>: Summarizes information about model components.</li>
</ol>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>broom<span class="sc">::</span><span class="fu">tidy</span>(multiv_model_out[[<span class="dv">3</span>]], <span class="at">conf.int =</span> <span class="cn">TRUE</span>, <span class="at">conf.level =</span> <span class="fl">0.95</span>)</span></code></pre></div>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["term"],"name":[1],"type":["chr"],"align":["left"]},{"label":["estimate"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["std.error"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["statistic"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["p.value"],"name":[5],"type":["dbl"],"align":["right"]},{"label":["conf.low"],"name":[6],"type":["dbl"],"align":["right"]},{"label":["conf.high"],"name":[7],"type":["dbl"],"align":["right"]}],"data":[{"1":"(Intercept)","2":"63.16424473843","3":"0.537655308","4":"117.48","5":"0.000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000","6":"62.1098563030","7":"64.2186331739"},{"1":"gdp","2":"0.00031288103","3":"0.000014068","4":"22.24","5":"0.000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000012","6":"0.0002852918","7":"0.0003404702"},{"1":"population","2":"0.00000000253","3":"0.000000014","4":"0.19","5":"0.851715766630702475481484725605696439743041992187500000000000000000000000000000000000000000000000000","6":"-0.0000000240","7":"0.0000000291"},{"1":"total_expenditure","2":"0.55852596004","3":"0.086556446","4":"6.45","5":"0.000000000135778740068988845293867444032856906660500229122590098995715379714965820312500000000000000","6":"0.3887813028","7":"0.7282706173"},{"1":"population:total_expenditure","2":"-0.00000000051","3":"0.000000003","4":"-0.17","5":"0.864618461973088225924755079176975414156913757324218750000000000000000000000000000000000000000000000","6":"-0.0000000064","7":"0.0000000053"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<ol start="2" style="list-style-type: decimal">
<li><code>glance()</code>: Reports information about the entire model.</li>
</ol>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>broom<span class="sc">::</span><span class="fu">glance</span>(multiv_model_out[[<span class="dv">3</span>]])</span></code></pre></div>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["r.squared"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["adj.r.squared"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["sigma"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["statistic"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["p.value"],"name":[5],"type":["dbl"],"align":["right"]},{"label":["df"],"name":[6],"type":["dbl"],"align":["right"]},{"label":["logLik"],"name":[7],"type":["dbl"],"align":["right"]},{"label":["AIC"],"name":[8],"type":["dbl"],"align":["right"]},{"label":["BIC"],"name":[9],"type":["dbl"],"align":["right"]},{"label":["deviance"],"name":[10],"type":["dbl"],"align":["right"]},{"label":["df.residual"],"name":[11],"type":["int"],"align":["right"]},{"label":["nobs"],"name":[12],"type":["int"],"align":["right"]}],"data":[{"1":"0.23","2":"0.23","3":"8.6","4":"162","5":"0.00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000036","6":"4","7":"-7579","8":"15170","9":"15204","10":"158130","11":"2115","12":"2120"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<ol start="2" style="list-style-type: decimal">
<li><code>augment()</code>: Adds information about observations to a dataset.</li>
</ol>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">augment</span>(multiv_model_out[[<span class="dv">3</span>]], <span class="at">se_fit =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> <span class="fu">head</span>(<span class="dv">3</span>)</span></code></pre></div>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":[".rownames"],"name":[1],"type":["chr"],"align":["left"]},{"label":["life_expectancy"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["gdp"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["population"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["total_expenditure"],"name":[5],"type":["dbl"],"align":["right"]},{"label":[".fitted"],"name":[6],"type":["dbl"],"align":["right"]},{"label":[".se.fit"],"name":[7],"type":["dbl"],"align":["right"]},{"label":[".resid"],"name":[8],"type":["dbl"],"align":["right"]},{"label":[".hat"],"name":[9],"type":["dbl"],"align":["right"]},{"label":[".sigma"],"name":[10],"type":["dbl"],"align":["right"]},{"label":[".cooksd"],"name":[11],"type":["dbl"],"align":["right"]},{"label":[".std.resid"],"name":[12],"type":["dbl"],"align":["right"]}],"data":[{"1":"1","2":"65","3":"584","4":"33736494","5":"8.2","6":"68","7":"0.41","8":"-2.9","9":"0.0023","10":"8.6","11":"0.000049","12":"-0.33"},{"1":"2","2":"60","3":"613","4":"327582","5":"8.2","6":"68","7":"0.30","8":"-8.0","9":"0.0012","10":"8.6","11":"0.000205","12":"-0.93"},{"1":"3","2":"60","3":"632","4":"31731688","5":"8.1","6":"68","7":"0.39","8":"-8.0","9":"0.0021","10":"8.6","11":"0.000349","12":"-0.92"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>I mean, doesn‚Äôt this look a lot nicer?</p>
</div>
<div id="broom-with-many-models" class="section level2">
<h2>Broom with Many Models</h2>
<p>Where <code>broom</code> really shines, is in dealing with many models like we have in our <code>multiv_model_out</code>. I include the .id argument in map to add a model identifier that consists of the names of the elements in the list.</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>multiv_model_out_broom <span class="ot">&lt;-</span> <span class="fu">map_dfr</span>(multiv_model_out, broom<span class="sc">::</span>tidy, <span class="at">.id =</span> <span class="st">&quot;model_type&quot;</span>)</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>multiv_model_out_broom <span class="sc">%&gt;%</span> <span class="fu">head</span>()</span></code></pre></div>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["model_type"],"name":[1],"type":["chr"],"align":["left"]},{"label":["term"],"name":[2],"type":["chr"],"align":["left"]},{"label":["estimate"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["std.error"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["statistic"],"name":[5],"type":["dbl"],"align":["right"]},{"label":["p.value"],"name":[6],"type":["dbl"],"align":["right"]}],"data":[{"1":"bivariate","2":"(Intercept)","3":"67.03504314149","4":"0.193910883","5":"345.700","6":"0.000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000"},{"1":"bivariate","2":"gdp","3":"0.00031165668","4":"0.000012024","5":"25.919","6":"0.000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000027"},{"1":"multivariate","2":"(Intercept)","3":"63.18818377039","4":"0.518883849","5":"121.777","6":"0.000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000"},{"1":"multivariate","2":"gdp","3":"0.00031293506","4":"0.000014062","5":"22.255","6":"0.000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000009235167065323018065818641326655543"},{"1":"multivariate","2":"population","3":"0.00000000028","4":"0.000000003","5":"0.093","6":"0.925582555157076547480698991421377286314964294433593750000000000000000000000000000000000000000000000000000000000000000000000000000000"},{"1":"multivariate","2":"total_expenditure","3":"0.55376178488","4":"0.081904424","5":"6.761","6":"0.000000000017657666686321208992724521990079847039850635681546009436715394258499145507812500000000000000000000000000000000000000000000"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>Now that we have our multiple model outputs in a format that we can work with, we can finally start thinking about visualizing our results.</p>
<hr />
</div>
</div>
<div id="modelling-results-with-modelsummary" class="section level1">
<h1>Modelling Results with <code>modelsummary</code></h1>
<p>For this we will use the excellent <code>modelsummary</code> package by <a href="https://vincentarelbundock.github.io/modelsummary/">Vincent Arel-Bundock‚Äôs</a>. Though there are many other options to choose from, we highly recommend you give it a shot!</p>
<div id="using-regression-tables" class="section level2">
<h2>Using Regression Tables</h2>
</div>
<div id="using-plots" class="section level2">
<h2>Using Plots</h2>
<hr />
</div>
</div>
<div id="further-resources" class="section level1">
<h1>Further Resources</h1>
<div id="modelling-packages" class="section level2">
<h2>Modelling Packages</h2>
</div>
<div id="visualisation-tools" class="section level2">
<h2>Visualisation tools</h2>
<hr />
</div>
</div>
<div id="appendix-tools-to-prepare-the-workshop" class="section level1">
<h1>Appendix: Tools to Prepare the Workshop</h1>
</div>

&nbsp;
<hr />
<p style="text-align: center;">A work by Lisa Oswald & Tom Arend</a></p>
<p style="text-align: center;"><span style="color: #808080;"><em>Prepared for Intro to Data Science, taught by Simon Munzert</em></span></p>
<p style="text-align: center;"><span style="color: #808080;"><em><a href="https://www.hertie-school.org/en/">Hertie School, Berlin</em></span></p>

<!-- Add icon library -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" >

<!-- Add font awesome icons -->
<p style="text-align: center;">
    <a href="https://github.com/intro-to-data-science-21"  <i class="fab fa-github"></i><a>
</p>

&nbsp;


</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->

<script>
$(document).ready(function ()  {

    // temporarily add toc-ignore selector to headers for the consistency with Pandoc
    $('.unlisted.unnumbered').addClass('toc-ignore')

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_');
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
