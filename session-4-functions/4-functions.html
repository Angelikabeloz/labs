<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />




<title>Functional Programming</title>

<script src="4-functions_files/header-attrs-2.11/header-attrs.js"></script>
<script src="4-functions_files/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="4-functions_files/bootstrap-3.3.5/css/lumen.min.css" rel="stylesheet" />
<script src="4-functions_files/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="4-functions_files/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="4-functions_files/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="4-functions_files/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="4-functions_files/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="4-functions_files/tocify-1.9.1/jquery.tocify.js"></script>
<script src="4-functions_files/navigation-1.1/tabsets.js"></script>
<link href="4-functions_files/pagedtable-1.1/css/pagedtable.css" rel="stylesheet" />
<script src="4-functions_files/pagedtable-1.1/js/pagedtable.js"></script>

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>


<style type="text/css">
  code {
    white-space: pre;
  }
  .sourceCode {
    overflow: visible;
  }
</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  background-color: #f8f8f8; }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ef2929; } /* Alert */
code span.an { color: #8f5902; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #c4a000; } /* Attribute */
code span.bn { color: #0000cf; } /* BaseN */
code span.cf { color: #204a87; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4e9a06; } /* Char */
code span.cn { color: #000000; } /* Constant */
code span.co { color: #8f5902; font-style: italic; } /* Comment */
code span.cv { color: #8f5902; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #8f5902; font-weight: bold; font-style: italic; } /* Documentation */
code span.dt { color: #204a87; } /* DataType */
code span.dv { color: #0000cf; } /* DecVal */
code span.er { color: #a40000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #0000cf; } /* Float */
code span.fu { color: #000000; } /* Function */
code span.im { } /* Import */
code span.in { color: #8f5902; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #204a87; font-weight: bold; } /* Keyword */
code span.op { color: #ce5c00; font-weight: bold; } /* Operator */
code span.ot { color: #8f5902; } /* Other */
code span.pp { color: #8f5902; font-style: italic; } /* Preprocessor */
code span.sc { color: #000000; } /* SpecialChar */
code span.ss { color: #4e9a06; } /* SpecialString */
code span.st { color: #4e9a06; } /* String */
code span.va { color: #000000; } /* Variable */
code span.vs { color: #4e9a06; } /* VerbatimString */
code span.wa { color: #8f5902; font-weight: bold; font-style: italic; } /* Warning */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    for (var j = 0; j < rules.length; j++) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") continue;
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') continue;
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>




<link rel="stylesheet" href="custom.css" type="text/css" />



<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
pre code {
  padding: 0;
}
</style>



<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->



<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}

@media print {
.toc-content {
  /* see https://github.com/w3c/csswg-drafts/issues/4434 */
  float: right;
}
}

.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div id="header">



<h1 class="title toc-ignore">Functional Programming</h1>
<h3 class="subtitle">Functions, Iteration and debugging in R</h3>

</div>


<p>This week, we will teach you one of <strong>the most
important</strong> parts of coding with R (and I cannot stress enough
how important it is). Built-in functions and packages can only get you
so far, there will be times when it is both easier and more efficient to
create your own. Writing your own functions is a key skill in any coding
language really, and R is no different. Unfortunately, writing your own
function also requires you to be able to find and fix bugs that will
inevitably creep into your code. For all of these reasons, this lab will
teach you how to:</p>
<ul>
<li>write your own functions</li>
<li>iterate functions over multiple inputs</li>
<li>vectorise your functions using the <code>purrr</code> package</li>
<li>debug your code</li>
</ul>
<hr />
<div id="quick-review-lists" class="section level1">
<h1>Quick review: lists</h1>
<p>One of the more important objects in R for functional programming are
lists. Since we only briefly touched upon them in Week 1, let’s go over
them again in more detail.</p>
<p>Vectors can only hold a single data type.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>vec <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="at">a =</span> <span class="st">&quot;hello&quot;</span>, <span class="at">b =</span> <span class="dv">1</span>)</span></code></pre></div>
<p>By comparison lists can hold many different data types at the same
time.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">list</span>(<span class="at">a =</span> <span class="st">&quot;hello&quot;</span>, <span class="at">b =</span> <span class="dv">1</span>, <span class="at">c =</span> mean)</span></code></pre></div>
<pre><code>## $a
## [1] &quot;hello&quot;
## 
## $b
## [1] 1
## 
## $c
## function (x, ...) 
## UseMethod(&quot;mean&quot;)
## &lt;bytecode: 0x11ed10f20&gt;
## &lt;environment: namespace:base&gt;</code></pre>
<p>When you think about, data.frames are also lists (or rather a list of
columns).</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gapminder)</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(gapminder)</span></code></pre></div>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["country"],"name":[1],"type":["fct"],"align":["left"]},{"label":["continent"],"name":[2],"type":["fct"],"align":["left"]},{"label":["year"],"name":[3],"type":["int"],"align":["right"]},{"label":["lifeExp"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["pop"],"name":[5],"type":["int"],"align":["right"]},{"label":["gdpPercap"],"name":[6],"type":["dbl"],"align":["right"]}],"data":[{"1":"Afghanistan","2":"Asia","3":"1952","4":"28.801","5":"8425333","6":"779.4453"},{"1":"Afghanistan","2":"Asia","3":"1957","4":"30.332","5":"9240934","6":"820.8530"},{"1":"Afghanistan","2":"Asia","3":"1962","4":"31.997","5":"10267083","6":"853.1007"},{"1":"Afghanistan","2":"Asia","3":"1967","4":"34.020","5":"11537966","6":"836.1971"},{"1":"Afghanistan","2":"Asia","3":"1972","4":"36.088","5":"13079460","6":"739.9811"},{"1":"Afghanistan","2":"Asia","3":"1977","4":"38.438","5":"14880372","6":"786.1134"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>You don’t believe me?</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">as.list</span>(<span class="fu">head</span>(gapminder))</span></code></pre></div>
<pre><code>## $country
## [1] Afghanistan Afghanistan Afghanistan Afghanistan Afghanistan Afghanistan
## 142 Levels: Afghanistan Albania Algeria Angola Argentina Australia ... Zimbabwe
## 
## $continent
## [1] Asia Asia Asia Asia Asia Asia
## Levels: Africa Americas Asia Europe Oceania
## 
## $year
## [1] 1952 1957 1962 1967 1972 1977
## 
## $lifeExp
## [1] 28.801 30.332 31.997 34.020 36.088 38.438
## 
## $pop
## [1]  8425333  9240934 10267083 11537966 13079460 14880372
## 
## $gdpPercap
## [1] 779.4453 820.8530 853.1007 836.1971 739.9811 786.1134</code></pre>
<p>Lists will be very common (and useful) once you get into the writing
of your functions and iterating them using the <code>purrr</code> family
of functions.</p>
<hr />
</div>
<div id="functions" class="section level1">
<h1>Functions</h1>
<p>In any coding language a fundamental principle should be
<strong>DRY</strong> (<strong>D</strong>on’t <strong>R</strong>epeat
<strong>Y</strong>ourself). You should adhere to this as much as
possible, but really, once you have copy-pasted code twice, it is time
to write a function.</p>
<p>Functions allow you to automate tasks in a more powerful and general
way than copy-and-pasting. Writing a function has three big advantages
over using copy-and-paste:</p>
<ol style="list-style-type: decimal">
<li><p>You can give a function an evocative name that makes your code
easier to understand.</p></li>
<li><p>As requirements change, you only need to update code in one
place, instead of many.</p></li>
<li><p>You eliminate the chance of making incidental mistakes when you
copy and paste (i.e. updating a variable name in one place, but not in
another).</p></li>
</ol>
<p>You can read more on functions in <a
href="https://r4ds.had.co.nz/functions.html#functions">this section</a>
of R for Data Science.</p>
<p>What does code look like that calls for writing a function? Something
along these lines:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">a =</span> <span class="fu">rnorm</span>(<span class="dv">100</span>, <span class="dv">5</span>, <span class="dv">2</span>),</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">b =</span> <span class="fu">rnorm</span>(<span class="dv">100</span>, <span class="dv">100</span>, <span class="dv">15</span>),</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">c =</span> <span class="fu">rnorm</span>(<span class="dv">100</span>, <span class="dv">2</span>, <span class="dv">1</span>),</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">d =</span> <span class="fu">rnorm</span>(<span class="dv">100</span>, <span class="dv">36</span>, <span class="dv">7</span>)</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>a <span class="ot">&lt;-</span> (df<span class="sc">$</span>a <span class="sc">-</span> <span class="fu">mean</span>(df<span class="sc">$</span>a, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">/</span> <span class="fu">sd</span>(df<span class="sc">$</span>a, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>b <span class="ot">&lt;-</span> (df<span class="sc">$</span>b <span class="sc">-</span> <span class="fu">mean</span>(df<span class="sc">$</span>b, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">/</span> <span class="fu">sd</span>(df<span class="sc">$</span>a, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="co"># spot the mistake?</span></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>c <span class="ot">&lt;-</span> (df<span class="sc">$</span>c <span class="sc">-</span> <span class="fu">mean</span>(df<span class="sc">$</span>c, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">/</span> <span class="fu">sd</span>(df<span class="sc">$</span>c, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>d <span class="ot">&lt;-</span> (df<span class="sc">$</span>d <span class="sc">-</span> <span class="fu">mean</span>(df<span class="sc">$</span>d, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">/</span> <span class="fu">sd</span>(df<span class="sc">$</span>d, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<p>There are three key steps to creating a new function:</p>
<ol style="list-style-type: decimal">
<li><p>Pick a <strong>name</strong> for the function. For us it could be
zscale because this function rescales (or z-transforms) a vector to have
a mean of 0 and a standard deviation of 1.</p></li>
<li><p>You list the <strong>inputs</strong>, or
<strong>arguments</strong>, to the function inside the brackets. Here we
have just one argument. If we had more, the call would look like this:
function(x, y, z).</p></li>
<li><p>You place the code you have developed in the
<strong>body</strong> of the function. The body of the function is
represented by a {} block that immediately follows the function(…)
call.</p></li>
</ol>
<p>The overall structure of a function looks like this:</p>
<pre><code>function_name &lt;- function(input_parameters) {
  Do what you want to do in the body of the
  function, just like you would write other code in R.
}</code></pre>
<p>In our example, we could simplify the z-transformation of 4 variables
with this function:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>zscale <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>  (x <span class="sc">-</span> <span class="fu">mean</span>(x, <span class="at">na.rm =</span> T) <span class="sc">/</span> <span class="fu">sd</span>(x, <span class="at">na.rm =</span> T))</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>A word on <strong>function names</strong>. Generally, function names
should be verbs, and arguments should be nouns. There are some
exceptions: nouns are ok if the function computes a very well known noun
(i.e. mean), or accessing some property of an object
(i.e. coefficients). A good sign that a noun might be a better choice is
if you’re using a very broad verb like “get”, “compute”, “calculate”, or
“determine”. Where possible, avoid overriding existing functions and
variables. This might be a little tricky sometimes, as many good names
are already taken by other packages. Nevertheless, avoiding the most
common names from base R will avoid confusion.</p>
<p>Let’s look at another example and work with a fictional experimental
study dataset “study.csv” that was generated for this course.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>study <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">&quot;./study.csv&quot;</span>)</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(study)</span></code></pre></div>
<pre><code>## Rows: 68
## Columns: 8
## $ age       &lt;dbl&gt; 32, 30, 32, 29, 24, 38, 25, 24, 48, 29, 22, 29, 24, 28, 24, …
## $ age_group &lt;chr&gt; &quot;30 and Older&quot;, &quot;30 and Older&quot;, &quot;30 and Older&quot;, &quot;Younger tha…
## $ gender    &lt;chr&gt; &quot;Male&quot;, &quot;Female&quot;, &quot;Female&quot;, &quot;Male&quot;, &quot;Female&quot;, &quot;Female&quot;, &quot;Fem…
## $ ht_in     &lt;dbl&gt; 70, 63, 62, 67, 67, 58, 64, 69, 65, 68, 63, 68, 69, 66, 67, …
## $ wt_lbs    &lt;dbl&gt; 216, 106, 145, 195, 143, 125, 138, 140, 158, 167, 145, 297, …
## $ bmi       &lt;dbl&gt; 30.99, 18.78, 26.52, 30.54, 22.39, 26.12, 23.69, 20.67, 26.2…
## $ bmi_3cat  &lt;chr&gt; &quot;Obese&quot;, &quot;Normal&quot;, &quot;Overweight&quot;, &quot;Obese&quot;, &quot;Normal&quot;, &quot;Overwei…
## $ emotions  &lt;chr&gt; &quot;sad&quot;, &quot;netural&quot;, &quot;netural&quot;, &quot;netural&quot;, &quot;happy&quot;, &quot;sad&quot;, &quot;net…</code></pre>
<div id="exercise-1" class="section level5">
<h5><strong>Exercise 1:</strong></h5>
<p>Can you write a function to calculate the mode for the relevant
variables in the data?</p>
</div>
<div id="exercise-2" class="section level5">
<h5><strong>Exercise 2:</strong></h5>
<p>What is the mode for the variable <code>bmi_3cat</code>?</p>
<hr />
</div>
</div>
<div id="conditional-functions" class="section level1">
<h1>Conditional functions</h1>
<p>In practice you will often encounter a situation in which you would
like to apply a function if a certain conditions are met. Luckily,
including conditions in your custom functions is fairly straightforward.
Here is what the syntax for such a conditional functions would look
like.</p>
<pre><code>if (this) {
  # do that
} else if (that) {
  # do something else
} else {
  # 
}</code></pre>
<p>The conditions in the normal brackets are specified using the logical
operators of R (<code>!=</code>, <code>==</code>, <code>&lt;</code>,
<code>&gt;</code>, etc.) or a function that returns a logical value. In
many ways these conditions follow the same approach we applied to
<code>filter()</code> during last week’s lab. The {} denominate the body
of the function, just as with unconditional functions.</p>
<p>You could, for example, only transform numeric variables and code the
function to warn you if you tried to scale a character variable.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>zscale <span class="ot">&lt;-</span> <span class="cf">function</span>(x){</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">is.numeric</span>(x)) {</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>  (x <span class="sc">-</span> <span class="fu">mean</span>(x, <span class="at">na.rm =</span> T) <span class="sc">/</span> <span class="fu">sd</span>(x, <span class="at">na.rm =</span> T))</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="fu">paste</span>(<span class="st">&quot;Not a numeric input!&quot;</span>))</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Now we can apply our function to any variable that we would like to
transform. It will run even if we apply it to a character input, but
warn us that the input does not fit the required input.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>a <span class="ot">&lt;-</span> <span class="fu">zscale</span>(df<span class="sc">$</span>a)</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>b <span class="ot">&lt;-</span> <span class="fu">zscale</span>(df<span class="sc">$</span>b)</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>c <span class="ot">&lt;-</span> <span class="fu">zscale</span>(df<span class="sc">$</span>c)</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>d <span class="ot">&lt;-</span> <span class="fu">zscale</span>(df<span class="sc">$</span>d)</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a><span class="co"># you can also use your function with a pipe!</span></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>d <span class="sc">%&gt;%</span> <span class="fu">zscale</span>()</span></code></pre></div>
<p>Note that there is still a lot of repetition in the example above. We
can get rid of this repetition using what coders call iteration 👇.</p>
<div id="exercise-3" class="section level5">
<h5><strong>Exercise 3:</strong></h5>
<p>You feel that the variable on emotions in our study dataset is badly
represented and you decide to replace it with Emoticons! You want to
write a function to automate this task. Transform this pseudo code into
an R function:</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>replace_w_emoticons <span class="ot">&lt;-</span> <span class="co"># If person is &quot;happy&quot;, person is &quot;:)&quot;, </span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>                       <span class="co"># Else if person is emotion &quot;neutral&quot;, person is &quot;:/&quot;</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>                       <span class="co"># Else person is &quot;:(&quot;</span></span></code></pre></div>
<hr />
</div>
</div>
<div id="iteration" class="section level1">
<h1>Iteration</h1>
<p>Iteration helps you when you need to do the same thing to multiple
inputs: repeating the same operation on different columns, or on
different datasets.</p>
<p>On the one hand, you have for loops and while loops which are a great
place to start because they make iteration very explicit. On the other
hand, functional programming (FP) offers tools to extract out duplicated
code, so each common for loop pattern gets its own function.</p>
<p>Remember the code above - it violates the rule of thumb that you
should not copy-paste code more than twice.</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># repetitive code</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>a <span class="ot">&lt;-</span> <span class="fu">zscale</span>(df<span class="sc">$</span>a)</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>b <span class="ot">&lt;-</span> <span class="fu">zscale</span>(df<span class="sc">$</span>b)</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>c <span class="ot">&lt;-</span> <span class="fu">zscale</span>(df<span class="sc">$</span>c)</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>d <span class="ot">&lt;-</span> <span class="fu">zscale</span>(df<span class="sc">$</span>d)</span></code></pre></div>
<p>To solve problems like this one with a for loop we need to think
again about the following three components:</p>
<ol style="list-style-type: decimal">
<li><p><strong>Output:</strong> we already have the output — it’s the
same as the input because we are modifying data. If that is not the
case, make sure to define a space where the output should go (e.g. an
empty vector). If the length of your vector is unknown, you might be
tempted to solve this problem by progressively growing the vector.
However, this is not very efficient because in each iteration, R has to
copy all the data from the previous iterations. In technical terms you
get “quadratic” (O(n^2)) behaviour which means that a loop with three
times as many elements would take nine (3^2) times as long to run. A
better solution to save the results in a list, and then combine into a
single vector after the loop is done. See more on this <a
href="https://r4ds.had.co.nz/iteration.html">here</a>.</p></li>
<li><p><strong>Sequence:</strong> we can think about a data frame as a
list of columns, so we can iterate over each column with
seq_along(df).</p></li>
<li><p><strong>Body:</strong> apply zscale() or any other
function.</p></li>
</ol>
<p>The better solution will look like this:</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># repetitive code</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>a <span class="ot">&lt;-</span> <span class="fu">zscale</span>(df<span class="sc">$</span>a)</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>b <span class="ot">&lt;-</span> <span class="fu">zscale</span>(df<span class="sc">$</span>b)</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>c <span class="ot">&lt;-</span> <span class="fu">zscale</span>(df<span class="sc">$</span>c)</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>d <span class="ot">&lt;-</span> <span class="fu">zscale</span>(df<span class="sc">$</span>d)</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a><span class="co"># equivalent iteration</span></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq_along</span>(df)) {       <span class="co"># seq_along() similar to length()</span></span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>  df[[i]] <span class="ot">&lt;-</span> <span class="fu">zscale</span>(df[[i]])     <span class="co"># [[]] because we are working on single elements</span></span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Remember, this only works for for-loops that manipulate existing
inputs (ie. columns in a dataframe). If you want to save the output of
your function in a different way, you need to define the object where
you wish to store the output <strong>ahead</strong> of the function.</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>output_median <span class="ot">&lt;-</span> <span class="fu">vector</span>(<span class="st">&quot;double&quot;</span>, <span class="fu">ncol</span>(df))</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq_along</span>(df)) {            </span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>  output_median[[i]] <span class="ot">&lt;-</span> <span class="fu">median</span>(df[[i]])    </span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>output_median</span></code></pre></div>
<pre><code>## [1]  0.12460191  1.23870526 -0.09560797 -0.04284436</code></pre>
<p>You should also be aware that there is a conditional version of
for-loops called while loops. There uses are a little more niche and as
such will not be covered in this lab. For those among you who are
curious about them can find a pretty good tutorial <a
href="https://www.r-bloggers.com/2021/09/r-while-loop/">here</a>.</p>
<hr />
</div>
<div id="the-purrr-package" class="section level1">
<h1>The <code>purrr</code> package 🐱</h1>
<p>For loops are not as important in R as they are in other languages
because R is a functional programming language. This means that it’s
possible to wrap up for loops in a function, and call that function
instead of using the for loop directly. 💡</p>
<p>The <code>purrr</code> package provides functions that eliminate the
need for many common for loops. The apply family of functions in base R
(<code>apply()</code>, <code>lapply()</code>, <code>tapply()</code>,
etc.) solve a similar problem, but purrr is more consistent and thus is
easier to learn. The most useful function will be
<code>map(.x, .f)</code>, where : * .x: a vector, list, or data frame *
.f: a function * it returns a list</p>
<div class="figure" style="text-align: center">
<img src="pics/purrr_f_list.png" alt="Logic behind vectorised functions (also called functional programming)." width="49%" height="20%" />
<p class="caption">
Logic behind vectorised functions (also called functional programming).
</p>
</div>
<p>The pattern of looping over a vector, doing something to each element
and saving the results is so common that the purrr package provides a
family of functions to do it for you. There is one function for each
type of output:</p>
<ul>
<li><code>map()</code> returns a list.</li>
<li><code>map_lgl()</code> returns a logical vector</li>
<li><code>map_int()</code> returns an integer vector.</li>
<li><code>map_dbl()</code> returns a double vector.</li>
<li><code>map_chr()</code> returns a character vector.</li>
</ul>
<p>Three ways to pass functions to <code>map()</code>:</p>
<ol style="list-style-type: decimal">
<li>pass directly to <code>map()</code></li>
</ol>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">map</span>(df, mean, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)                        </span></code></pre></div>
<ol start="2" style="list-style-type: decimal">
<li>use an anonymous function</li>
</ol>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">map</span>(df, <span class="cf">function</span>(.x) {</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mean</span>(.x, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) }</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<ol start="3" style="list-style-type: decimal">
<li>use ~</li>
</ol>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="fu">map</span>(df, <span class="sc">~</span> <span class="fu">mean</span>(.x, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span></code></pre></div>
<p>Let’s look at this in practice. Imagine you want to calculate the
mean of each column in your df:</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co"># repetitive code</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(df<span class="sc">$</span>a)</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(df<span class="sc">$</span>b)</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(df<span class="sc">$</span>c)</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(df<span class="sc">$</span>d)</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a><span class="co"># equivalent map function</span></span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a><span class="fu">map</span>(<span class="at">.x =</span> df, <span class="sc">~</span> <span class="fu">mean</span>(.x, <span class="at">na.rm =</span>T))</span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a><span class="co"># map function in tidyverse style</span></span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a>df <span class="sc">%&gt;%</span> <span class="fu">map</span>(mean)</span></code></pre></div>
<div id="exercise-3-1" class="section level5">
<h5><strong>Exercise 3:</strong></h5>
<p>Since all of the means are numeric, it makes more sense to store them
in a vectors, which function should I use?</p>
</div>
<div id="mapping-over-two-lists-at-the-same-time"
class="section level2">
<h2>mapping over two lists at the same time</h2>
<p>You can also iterate over two lists at the same time using
<code>map2(.x, .y, .f)</code></p>
<div class="figure" style="text-align: center">
<img src="pics/purr_f2_input.png" alt="Logic behind map2()." width="49%" height="20%" />
<p class="caption">
Logic behind map2().
</p>
</div>
<p>The function works exactly as the map* functions for a single input.
One caveat that applies only to <code>map2()</code> is that both inputs
need to have the <strong>same length</strong>!</p>
<p>There is, of course, much more to learn about functions in R and for
those of you who want to take it further you can find some great
resources here or here. For now, consider this as is the first exposure
to functions (that can actually already get you pretty far). However, it
is important that you apply 🤓 you new skills and practice further on
your own.</p>
<div id="exercise-4" class="section level5">
<h5><strong>Exercise 4:</strong></h5>
<p>Write a function that returns both the mean and the standard
deviation for the numeric variables in our study data.</p>
</div>
<div id="exercise-5" class="section level5">
<h5><strong>Exercise 5:</strong></h5>
<p>Iterate over the relevant columns.</p>
</div>
<div id="exercise-5-1" class="section level5">
<h5><strong>Exercise 5:</strong></h5>
<p>Use <code>map</code> and the <code>tolower</code> function to
harmonise character values in the study dataframe.</p>
<hr />
</div>
</div>
<div id="actually-learning-r" class="section level2">
<h2>Actually learning R 🎒</h2>
<p>Let us remind you again, the key to learning <code>R</code> is:
<strong>Google</strong>! We can only give you an overview over basic
<code>R</code> functions, but to really learn <code>R</code> you will
have to actively use it yourself, trouble shoot, ask questions, and
google! It is very likely that someone else has had the exact same or
just <em>similar enough</em> issue before and that the R community has
answered it with 5+ different solutions years ago. 😉</p>
<hr />
</div>
</div>
<div id="sources" class="section level1 unnumbered">
<h1 class="unnumbered">Sources</h1>
<p>The section on functions and iteration is partly based on <a
href="http://r4ds.had.co.nz/"><em>R for Data Science</em></a>, section
5.2, <a href="http://qpolr.com/data.html/"><em>Quantitative Politics
with R</em></a>, chapter 3; as well as the <a
href="https://github.com/uo-ec607/lectures/tree/master/05-tidyverse">Tidyverse
Session</a> and on the excellent slides by <a
href="https://github.com/malcolmbarrett/happy_scientist"><em>Malcolm
Barrett</em></a> in the course Data Science for Economists by Grant
McDermott. The data for the exercises was inspired by <a
href="https://www.r4epi.com/">R for Epidemiology</a>. The section on
functions relies</p>
</div>

&nbsp;
<hr />
<p style="text-align: center;">A work by Lisa Oswald & Tom Arend</a></p>
<p style="text-align: center;"><span style="color: #808080;"><em>Prepared for Intro to Data Science, taught by Simon Munzert</em></span></p>
<p style="text-align: center;"><span style="color: #808080;"><em><a href="https://www.hertie-school.org/en/">Hertie School, Berlin</em></span></p>

<!-- Add icon library -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" >

<!-- Add font awesome icons -->
<p style="text-align: center;">
    <a href="https://github.com/intro-to-data-science-21"  <i class="fab fa-github"></i><a>
</p>

&nbsp;


</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->

<script>
$(document).ready(function ()  {

    // temporarily add toc-ignore selector to headers for the consistency with Pandoc
    $('.unlisted.unnumbered').addClass('toc-ignore')

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_');
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
