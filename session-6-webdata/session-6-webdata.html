<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />




<title>Webdata</title>

<script src="session-6-webdata_files/header-attrs-2.14/header-attrs.js"></script>
<script src="session-6-webdata_files/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="session-6-webdata_files/bootstrap-3.3.5/css/lumen.min.css" rel="stylesheet" />
<script src="session-6-webdata_files/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="session-6-webdata_files/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="session-6-webdata_files/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="session-6-webdata_files/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="session-6-webdata_files/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="session-6-webdata_files/tocify-1.9.1/jquery.tocify.js"></script>
<script src="session-6-webdata_files/navigation-1.1/tabsets.js"></script>
<link href="session-6-webdata_files/pagedtable-1.1/css/pagedtable.css" rel="stylesheet" />
<script src="session-6-webdata_files/pagedtable-1.1/js/pagedtable.js"></script>
<script src="session-6-webdata_files/htmlwidgets-1.5.4/htmlwidgets.js"></script>
<link href="session-6-webdata_files/str_view-0.1.0/str_view.css" rel="stylesheet" />
<script src="session-6-webdata_files/str_view-binding-1.4.0/str_view.js"></script>

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>



<style type="text/css">
  code {
    white-space: pre;
  }
  .sourceCode {
    overflow: visible;
  }
</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  background-color: #f8f8f8; }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ef2929; } /* Alert */
code span.an { color: #8f5902; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #c4a000; } /* Attribute */
code span.bn { color: #0000cf; } /* BaseN */
code span.cf { color: #204a87; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4e9a06; } /* Char */
code span.cn { color: #000000; } /* Constant */
code span.co { color: #8f5902; font-style: italic; } /* Comment */
code span.cv { color: #8f5902; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #8f5902; font-weight: bold; font-style: italic; } /* Documentation */
code span.dt { color: #204a87; } /* DataType */
code span.dv { color: #0000cf; } /* DecVal */
code span.er { color: #a40000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #0000cf; } /* Float */
code span.fu { color: #000000; } /* Function */
code span.im { } /* Import */
code span.in { color: #8f5902; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #204a87; font-weight: bold; } /* Keyword */
code span.op { color: #ce5c00; font-weight: bold; } /* Operator */
code span.ot { color: #8f5902; } /* Other */
code span.pp { color: #8f5902; font-style: italic; } /* Preprocessor */
code span.sc { color: #000000; } /* SpecialChar */
code span.ss { color: #4e9a06; } /* SpecialString */
code span.st { color: #4e9a06; } /* String */
code span.va { color: #000000; } /* Variable */
code span.vs { color: #4e9a06; } /* VerbatimString */
code span.wa { color: #8f5902; font-weight: bold; font-style: italic; } /* Warning */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    for (var j = 0; j < rules.length; j++) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") continue;
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') continue;
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>




<link rel="stylesheet" href="custom.css" type="text/css" />



<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
details > summary > p:only-child {
  display: inline;
}
pre code {
  padding: 0;
}
</style>



<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->



<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}

@media print {
.toc-content {
  /* see https://github.com/w3c/csswg-drafts/issues/4434 */
  float: right;
}
}

.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div id="header">



<h1 class="title toc-ignore">Webdata</h1>
<h3 class="subtitle">Wokring with xpath and regex</h3>

</div>


<hr />
<p>After our last session where we learned how to connect R to a
database and query it, today’s session will focus on webdata and regular
expressions. First, we will use R to inspect and locate elements in html
and xml structures using xpath. Then, we will quickly look at
<code>stringr</code> and wrap up with regular expressions.</p>
<p>Both xpath and regular expressions are extremely useful when it comes
to webdata. Locating data in nested html structures is particularly
useful when it comes to scraping, our next session.</p>
<p>Regular expressions are handy whenever manipulating strings and will
serve you well in many situations. In the context of webdata, they can
be particularly useful when handling the type of uncleaned data we get
after we scraped the internet and need to extract specific information
or just tidy up our results.</p>
<div id="html-structure" class="section level1">
<h1>HTML structure 🌳</h1>
<p>Here is an example of a document object model (DOM). Notice how the
there is a cascading structure of html nodes.</p>
<div class="sourceCode" id="cb1"><pre
class="sourceCode html"><code class="sourceCode html"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;!DOCTYPE </span>html<span class="dt">&gt;</span> </span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>  <span class="kw">&lt;html&gt;</span> </span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">&lt;head&gt;</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>      <span class="kw">&lt;title</span> <span class="er">id</span><span class="ot">=</span><span class="st">1</span><span class="kw">&gt;</span>First HTML<span class="kw">&lt;/title&gt;</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">&lt;/head&gt;</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>  <span class="kw">&lt;body&gt;</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>      <span class="kw">&lt;div&gt;</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>          <span class="kw">&lt;h1&gt;</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>            I am your first HTML file!</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>          <span class="kw">&lt;/h1&gt;</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>      <span class="kw">&lt;/div&gt;</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>  <span class="kw">&lt;/body&gt;</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;/html&gt;</span></span></code></pre></div>
<p>A simple xpath in this example would be
<code>html/body/div/h1</code>. The simple slashes in this example
indicate an <em>absolute path</em>. This means, we start at the root
node and follow the whole way down to our target element h1.</p>
<p><em>Relative paths</em> on the other hand are indicated with double
slashes <code>//</code>. Relative paths skip nodes and do not need to
start at the root node. An example here would be
<code>//body//h1</code>.</p>
<p>Now let’s have a look at how to do this in R:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rvest)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(stringr)</span></code></pre></div>
<p>Before we can go ahead and locate elements on a webpage with xpaths,
we need to parse our webpage. Parsing a website in R is
straightforward:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>parsed_doc <span class="ot">&lt;-</span> <span class="fu">read_html</span>(<span class="st">&quot;http://www.r-datacollection.com/materials/ch-4-xpath/fortunes/fortunes.html&quot;</span>) </span></code></pre></div>
<p>Now that we have the parsed document, we can locate individual
elements with the xpath. For this we use <code>rvest</code>, a library
that you will learn more about in the next session. The
<code>html_elements()</code> function finds and select</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">html_elements</span>(parsed_doc, <span class="at">xpath =</span> <span class="st">&quot;/html/body/div/p/i&quot;</span>)</span></code></pre></div>
<pre><code>## {xml_nodeset (2)}
## [1] &lt;i&gt;&#39;What we have is nice, but we need something very different&#39;&lt;/i&gt;
## [2] &lt;i&gt;&#39;R is wonderful, but it cannot work magic&#39;&lt;/i&gt;</code></pre>
</div>
<div id="xpath-basics" class="section level1">
<h1>Xpath Basics 👩‍💻</h1>
<p>Now let’s look at more complex examples of xpaths.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">include_graphics</span>(<span class="st">&quot;pics/Xpath.png&quot;</span>)</span></code></pre></div>
<p><img src="pics/Xpath.png" width="1024" /></p>
<p>While we can use R to inspect the parsed document, it is much easier
to do this part in the browser. To do so, we right click anywhere on the
website and click on “Inspect” or. On windows, you can also simply press
F12.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">include_graphics</span>(<span class="st">&quot;pics/inspect.png&quot;</span>)</span></code></pre></div>
<p><img src="pics/inspect.png" width="625" /></p>
<p>This opens up the developer tools interface on your browser. The most
important tab in the developer tools is the “Elements” tab. This tab
shows you the source code of the webpage in an interactive manner. Now,
when we hover over the elements in the tab they will be highlighted on
the webpage. By clicking the mouse icon on the top left, we can reverse
this behaviour.</p>
</div>
<div id="string-manipulation-with-stringr" class="section level1">
<h1>String manipulation with <code>stringr</code> 💬</h1>
<p><code>stringr</code> and <code>stringi</code> are the two most common
libraries for string manipulation in R. Before we look into regular
expressions, let us quickly look into some of th core functionalities of
<code>stringr</code> and how you can use them.</p>
<p>Here is a quick overview of the most useful functions in the
<code>stringr</code> package:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;apple&quot;</span>, <span class="st">&quot;banana&quot;</span>, <span class="st">&quot;pear&quot;</span>)</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="fu">str_detect</span>(x, <span class="st">&quot;e&quot;</span>)</span></code></pre></div>
<pre><code>## [1]  TRUE FALSE  TRUE</code></pre>
<p>To extract the actual text of a match, use
<code>str_extract()</code>. Note that <code>str_extract()</code> only
extracts the first match. To get all matches, use
<code>str_extract_all()</code>, which returns a list.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str_extract_all</span>(x, <span class="st">&#39;a&#39;</span>)</span></code></pre></div>
<pre><code>## [[1]]
## [1] &quot;a&quot;
## 
## [[2]]
## [1] &quot;a&quot; &quot;a&quot; &quot;a&quot;
## 
## [[3]]
## [1] &quot;a&quot;</code></pre>
<p><code>str_replace()</code> and <code>str_replace_all()</code> allow
you to replace matches with new strings. The simplest way is to replace
a fixed string, however with <code>str_replace_all()</code> you can
perform multiple replacements by supplying a named vector:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str_replace_all</span>(x, <span class="fu">c</span>(<span class="st">&quot;a&quot;</span> <span class="ot">=</span> <span class="st">&quot;A&quot;</span>, <span class="st">&quot;b&quot;</span> <span class="ot">=</span> <span class="st">&quot;B&quot;</span>, <span class="st">&quot;p&quot;</span> <span class="ot">=</span> <span class="st">&quot;P&quot;</span>))</span></code></pre></div>
<pre><code>## [1] &quot;APPle&quot;  &quot;BAnAnA&quot; &quot;PeAr&quot;</code></pre>
<p><code>str_locate()</code> and <code>str_locate_all()</code> give you
the starting and ending positions of each match. These are particularly
useful when none of the other functions does exactly what you want.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str_locate</span>(x, <span class="st">&#39;a&#39;</span>)</span></code></pre></div>
<pre><code>##      start end
## [1,]     1   1
## [2,]     2   2
## [3,]     3   3</code></pre>
</div>
<div id="regular-expressions" class="section level1">
<h1>Regular expressions 📝</h1>
<p><img src="pics/xkcd_regex.png" width="90%" style="display: block; margin: auto;" /></p>
<p>Regular expressions (Regex) allow us to manipulate strings based on
pattern matching. Regex patterns specify a sequence of strings, either
explicitly or by meta characters. While they can be a hard nut to crack,
they are extremely useful.</p>
<p>Meta characters allow us to abstract from explicit patterns. These
meta characters are <code>. \ | ( ) [ { ^ $ * + ?</code>. For example,
<code>.</code> is called a wildcard, as it matches any character, except
for line breaks (<code>\n</code>).</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str_view</span>(x, <span class="st">&quot;a.&quot;</span>)</span></code></pre></div>
<div id="htmlwidget-24e881bff036bfa8d006" style="width:960px;height:100%;" class="str_view html-widget"></div>
<script type="application/json" data-for="htmlwidget-24e881bff036bfa8d006">{"x":{"html":"<ul>\n  <li><span class='match'>ap<\/span>ple<\/li>\n  <li>b<span class='match'>an<\/span>ana<\/li>\n  <li>pe<span class='match'>ar<\/span><\/li>\n<\/ul>"},"evals":[],"jsHooks":[]}</script>
<p><code>? * + {n} {n,} {n,m}</code> are so-called <em>quantifiers</em>,
that allow us to match the preceding character either zero or one
<code>?</code>, zero or more <code>.</code>, or one or more
<code>+</code> times. <code>{n}</code> allows us to match a pattern
exactly n times. To match n times and more, we add a comma in the curly
brackets <code>{n,}</code> and to match between n and m times, we use
<code>{n,m}</code>.</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str_view</span>(x, <span class="st">&quot;p+&quot;</span>)</span></code></pre></div>
<div id="htmlwidget-f6c61838d6712de86bf4" style="width:960px;height:100%;" class="str_view html-widget"></div>
<script type="application/json" data-for="htmlwidget-f6c61838d6712de86bf4">{"x":{"html":"<ul>\n  <li>a<span class='match'>pp<\/span>le<\/li>\n  <li>banana<\/li>\n  <li><span class='match'>p<\/span>ear<\/li>\n<\/ul>"},"evals":[],"jsHooks":[]}</script>
<p>We can also match for specific <em>character classes</em>: If you
would like to match whitespaces (spaces, linebreaks, tabs) you can use
<code>\\w</code>. To match any digit, simply use <code>\\d</code>, for
word character (digits and alphabetic characters) you can use
<code>\\w</code>. We can negate those character classes by using them in
uppercase (e.g. <code>\\D</code> matching all non-digits).</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="st">&quot;1. A small sentence. - 2. Another tiny sentence.&quot;</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="fu">str_view_all</span>(y, <span class="st">&quot;</span><span class="sc">\\</span><span class="st">s(</span><span class="sc">\\</span><span class="st">w{4,5})</span><span class="sc">\\</span><span class="st">s&quot;</span>)</span></code></pre></div>
<div id="htmlwidget-f48dc0714580ec961804" style="width:960px;height:100%;" class="str_view html-widget"></div>
<script type="application/json" data-for="htmlwidget-f48dc0714580ec961804">{"x":{"html":"<ul>\n  <li>1. A<span class='match'> small <\/span>sentence. - 2. Another<span class='match'> tiny <\/span>sentence.<\/li>\n<\/ul>"},"evals":[],"jsHooks":[]}</script>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str_view_all</span>(y, <span class="st">&quot;</span><span class="sc">\\</span><span class="st">d</span><span class="sc">\\</span><span class="st">W&quot;</span>)</span></code></pre></div>
<div id="htmlwidget-c40fe1a1c5f34ae3bfc0" style="width:960px;height:100%;" class="str_view html-widget"></div>
<script type="application/json" data-for="htmlwidget-c40fe1a1c5f34ae3bfc0">{"x":{"html":"<ul>\n  <li><span class='match'>1.<\/span> A small sentence. - <span class='match'>2.<\/span> Another tiny sentence.<\/li>\n<\/ul>"},"evals":[],"jsHooks":[]}</script>
<p>R’s regex implmentation also ships with a number of predefined
character classes, like <code>[:upper:]</code>, <code>[:lower:]</code>
and <code>[:punct:]</code>. They are usually simpler and much easier to
remember than corresponding regex patterns. Note however, that these
will require double squared brackets in many of the base R
functions.</p>
<p>Next to character classes and quantifiers, <em>anchors</em> match the
start <code>^</code> or end <code>$</code> of a string.
<em>Alternates</em> allow us to handle multiple cases in our pattern. As
in R <code>|</code>, is equivalent to an or. With <code>[qwert]</code>
we are creating a “one of” pattern that matches any of the strings in
the squared brackets. To negate this and get “anything but” we use
<code>[^qwert]</code>. Parenthesis in regex are used to create groups
and establish an order of evaluation.</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str_view</span>(x, <span class="st">&quot;^a|b&quot;</span>)</span></code></pre></div>
<div id="htmlwidget-d897292706234680a164" style="width:960px;height:100%;" class="str_view html-widget"></div>
<script type="application/json" data-for="htmlwidget-d897292706234680a164">{"x":{"html":"<ul>\n  <li><span class='match'>a<\/span>pple<\/li>\n  <li><span class='match'>b<\/span>anana<\/li>\n  <li>pear<\/li>\n<\/ul>"},"evals":[],"jsHooks":[]}</script>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>fruits <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;apple&quot;</span>, <span class="st">&quot;orange&quot;</span>, <span class="st">&quot;pear&quot;</span>)</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>fruit_match <span class="ot">&lt;-</span> <span class="fu">str_c</span>(fruits, <span class="at">collapse =</span> <span class="st">&quot;|&quot;</span>)</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a><span class="fu">str_subset</span>(stringr<span class="sc">::</span>sentences, fruit_match) <span class="sc">%&gt;%</span> <span class="fu">head</span>(<span class="dv">3</span>)</span></code></pre></div>
<pre><code>## [1] &quot;The pearl was worn in a thin silver ring.&quot;
## [2] &quot;The fruit of a fig tree is apple-shaped.&quot; 
## [3] &quot;Canned pears lack full flavor.&quot;</code></pre>
<p>At this point you may wonder yourself, how we match those characters
that are used as meta characters in regex.T his is where it gets
complicated. Theoretically, we only use <code>\</code> as an escape
character. However, we also use regular characters, like <code>\d</code>
for instance, to match digits or <code>\s</code> to match white spaces.
Therefore, we add another backward slash to escape the meta character
<code>\\</code>. To match a question mark, we would use
<code>\\?</code>.</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>z <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&#39;abc?defg&#39;</span>, <span class="st">&#39;123456?89&#39;</span>, <span class="st">&quot;[?.{!]</span><span class="sc">\\</span><span class="st">&quot;</span>)</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="fu">str_view</span>(z, <span class="st">&#39;</span><span class="sc">\\</span><span class="st">?&#39;</span>)</span></code></pre></div>
<div id="htmlwidget-7a4e452f0c7b9ad1ab17" style="width:960px;height:100%;" class="str_view html-widget"></div>
<script type="application/json" data-for="htmlwidget-7a4e452f0c7b9ad1ab17">{"x":{"html":"<ul>\n  <li>abc<span class='match'>?<\/span>defg<\/li>\n  <li>123456<span class='match'>?<\/span>89<\/li>\n  <li>[<span class='match'>?<\/span>.{!]\\<\/li>\n<\/ul>"},"evals":[],"jsHooks":[]}</script>
<p>Finally a word of caution at the end: Since regular expressions are
extremely powerful in string manipulation, it is easy to try and solve
every problem with a single regex. Do not forget that you have other
tools available in a programming language and you can break down the
problem by writing a series of simpler regexes.</p>
</div>
<div id="regex-exercises" class="section level1">
<h1>Regex exercises 🔧</h1>
<ol style="list-style-type: decimal">
<li>Can you explain what these regular expressions match?</li>
</ol>
<ul>
<li><code>"^.*$"</code></li>
<li><code>"\\{.+\\}"</code></li>
<li><code>"\\d{4}-\\d{2}-\\d{2}"</code></li>
<li><code>"\\\\{4}"</code></li>
</ul>
<ol start="2" style="list-style-type: decimal">
<li>How many words are there in <code>stringr::words</code> that end
with a “y” and are exactly 3 characers long?</li>
</ol>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str_detect</span>(stringr<span class="sc">::</span>words, <span class="st">&#39;^</span><span class="sc">\\</span><span class="st">w{2}y$&#39;</span>) <span class="sc">%&gt;%</span> sum</span></code></pre></div>
<pre><code>## [1] 15</code></pre>
<ol start="3" style="list-style-type: decimal">
<li>Now, try to find all words that end with “-ed” but not with
“eed”!</li>
</ol>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str_subset</span>(stringr<span class="sc">::</span>words, <span class="st">&quot;[^e]ed$&quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;bed&quot;     &quot;hundred&quot; &quot;red&quot;</code></pre>
<ol start="4" style="list-style-type: decimal">
<li>Let us now write a pattern that matches both emails in the vector
below.</li>
</ol>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>hertie_emails <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&#39;456123@students.hertie-school.org&#39;</span>, <span class="st">&#39;h.simpson@students.hertie-school.org&#39;</span>)</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="fu">str_view</span>(hertie_emails, <span class="st">&#39;(^</span><span class="sc">\\</span><span class="st">d{6}|^</span><span class="sc">\\</span><span class="st">w</span><span class="sc">\\</span><span class="st">.</span><span class="sc">\\</span><span class="st">w{1,})@students</span><span class="sc">\\</span><span class="st">.hertie-school</span><span class="sc">\\</span><span class="st">.org&#39;</span>)</span></code></pre></div>
<div id="htmlwidget-149f3cf801ddbe6d5936" style="width:960px;height:100%;" class="str_view html-widget"></div>
<script type="application/json" data-for="htmlwidget-149f3cf801ddbe6d5936">{"x":{"html":"<ul>\n  <li><span class='match'>456123@students.hertie-school.org<\/span><\/li>\n  <li><span class='match'>h.simpson@students.hertie-school.org<\/span><\/li>\n<\/ul>"},"evals":[],"jsHooks":[]}</script>
<ol start="5" style="list-style-type: decimal">
<li>Now try to extract all names and corresponding phone numbers from
the string below.</li>
</ol>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>raw_data <span class="ot">&lt;-</span> <span class="st">&quot;555-1239Moe Szyslak(636) 555-0113Burns, C. Montgomery555-6542Rev. Timothy Lovejoy555 8904Ned Flanders636-555-3226Simpson, Homer5553642Dr. Julius Hibbert&quot;</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a><span class="fu">str_view_all</span>(raw_data, <span class="st">&quot;[[:alpha:]., ]{2,}&quot;</span>)</span></code></pre></div>
<div id="htmlwidget-a7c226f730d1935ab740" style="width:960px;height:100%;" class="str_view html-widget"></div>
<script type="application/json" data-for="htmlwidget-a7c226f730d1935ab740">{"x":{"html":"<ul>\n  <li>555-1239<span class='match'>Moe Szyslak<\/span>(636) 555-0113<span class='match'>Burns, C. Montgomery<\/span>555-6542<span class='match'>Rev. Timothy Lovejoy<\/span>555 8904<span class='match'>Ned Flanders<\/span>636-555-3226<span class='match'>Simpson, Homer<\/span>5553642<span class='match'>Dr. Julius Hibbert<\/span><\/li>\n<\/ul>"},"evals":[],"jsHooks":[]}</script>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str_view_all</span>(raw_data, <span class="st">&quot;</span><span class="sc">\\</span><span class="st">(?(</span><span class="sc">\\</span><span class="st">d{3})?</span><span class="sc">\\</span><span class="st">)?(-| )?</span><span class="sc">\\</span><span class="st">d{3}(-| )?</span><span class="sc">\\</span><span class="st">d{4}&quot;</span>)</span></code></pre></div>
<div id="htmlwidget-ca12c85420ea7e68f634" style="width:960px;height:100%;" class="str_view html-widget"></div>
<script type="application/json" data-for="htmlwidget-ca12c85420ea7e68f634">{"x":{"html":"<ul>\n  <li><span class='match'>555-1239<\/span>Moe Szyslak<span class='match'>(636) 555-0113<\/span>Burns, C. Montgomery<span class='match'>555-6542<\/span>Rev. Timothy Lovejoy<span class='match'>555 8904<\/span>Ned Flanders<span class='match'>636-555-3226<\/span>Simpson, Homer<span class='match'>5553642<\/span>Dr. Julius Hibbert<\/li>\n<\/ul>"},"evals":[],"jsHooks":[]}</script>
</div>
<div id="sources" class="section level1">
<h1>Sources</h1>
<p>This tutorial drew heavily on Simon Munzert’s book <a
href="http://r-datacollection.com/">Automated Data Collection with R</a>
and related <a
href="https://github.com/simonmunzert/web-scraping-with-r-extended-edition">course
materials</a>. For the regex part, we used examples from the string
manipulation section in Hadley Wickham’ s <a
href="https://r4ds.had.co.nz/strings.html">R for Data Science</a>
book.</p>
</div>

&nbsp;
<hr />
<p style="text-align: center;">A work by Lisa Oswald & Tom Arend</a></p>
<p style="text-align: center;"><span style="color: #808080;"><em>Prepared for Intro to Data Science, taught by Simon Munzert</em></span></p>
<p style="text-align: center;"><span style="color: #808080;"><em><a href="https://www.hertie-school.org/en/">Hertie School, Berlin</em></span></p>

<!-- Add icon library -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" >

<!-- Add font awesome icons -->
<p style="text-align: center;">
    <a href="https://github.com/intro-to-data-science-21"  <i class="fab fa-github"></i><a>
</p>

&nbsp;


</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->

<script>
$(document).ready(function ()  {

    // temporarily add toc-ignore selector to headers for the consistency with Pandoc
    $('.unlisted.unnumbered').addClass('toc-ignore')

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_');
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
